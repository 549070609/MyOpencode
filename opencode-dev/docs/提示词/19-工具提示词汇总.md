# 工具提示词汇总

## 用途说明

本文档汇总了 OpenCode 中各种工具的提示词，定义了每个工具的用法、参数和最佳实践。

---

## 一、文件操作工具

### 1. Read (读取文件)

```
从本地文件系统读取文件。您可以使用此工具直接访问任何文件。
假设此工具能够读取机器上的所有文件。如果用户提供了文件路径，请假设该路径有效。读取不存在的文件是可以的；将返回错误。

使用说明：
- filePath 参数必须是绝对路径，而不是相对路径
- 默认情况下，它从文件开头读取最多 2000 行
- 您可以选择指定行偏移量和限制（对于长文件特别有用），但建议不提供这些参数以读取整个文件
- 任何超过 2000 个字符的行将被截断
- 结果使用 cat -n 格式返回，行号从 1 开始
- 您有能力在单个响应中调用多个工具。预先批量读取可能有用的多个文件总是更好的做法。
- 如果您读取的文件存在但内容为空，您将收到系统提醒警告而不是文件内容。
- 您可以使用此工具读取图像文件。
```

### 2. Write (写入文件)

```
将文件写入本地文件系统。

使用说明：
- 如果提供的路径已存在文件，此工具将覆盖现有文件。
- 如果这是现有文件，您必须先使用 Read 工具读取文件内容。如果您没有先读取文件，此工具将失败。
- 始终优先编辑代码库中的现有文件。除非明确要求，切勿创建新文件。
- 切勿主动创建文档文件（*.md）或 README 文件。仅在用户明确要求时才创建文档文件。
- 仅在用户明确要求时使用表情符号。除非被要求，否则避免在文件中写入表情符号。
```

### 3. Edit (编辑文件)

```
在文件中执行精确的字符串替换。

使用说明：
- 在编辑之前，您必须在对话中至少使用一次 `Read` 工具。如果您尝试在未读取文件的情况下进行编辑，此工具将报错。
- 当从 Read 工具输出中编辑文本时，请确保保留行号前缀之后的精确缩进（制表符/空格）。行号前缀格式为：空格 + 行号 + 制表符。制表符之后的所有内容才是需要匹配的实际文件内容。切勿在 oldString 或 newString 中包含行号前缀的任何部分。
- 始终优先编辑代码库中的现有文件。除非明确要求，切勿创建新文件。
- 仅在用户明确要求时使用表情符号。除非被要求，否则避免在文件中添加表情符号。
- 如果在文件中找不到 `oldString`，编辑将失败并显示错误 "oldString not found in content"。
- 如果 `oldString` 在文件中出现多次，编辑将失败并显示错误 "oldString found multiple times and requires more code context to uniquely identify the intended match"。请提供更多上下文使其唯一，或使用 `replaceAll` 更改所有实例。
- 使用 `replaceAll` 在整个文件中替换和重命名字符串。例如，如果您想重命名一个变量，这个参数很有用。
```

### 4. MultiEdit (多编辑)

```
这是一个在单次操作中对单个文件进行多次编辑的工具。它建立在 Edit 工具之上，允许您高效地执行多个查找替换操作。当您需要对同一文件进行多次编辑时，优先使用此工具而不是 Edit 工具。

使用此工具之前：
1. 使用 Read 工具了解文件的内容和上下文
2. 验证目录路径是否正确

要进行多文件编辑，请提供以下内容：
1. file_path：要修改的文件的绝对路径（必须是绝对路径，而不是相对路径）
2. edits：要执行的编辑操作数组，每个编辑包含：
   - oldString：要替换的文本（必须与文件内容完全匹配，包括所有空格和缩进）
   - newString：用于替换 oldString 的编辑后文本
   - replaceAll：替换所有 oldString 的出现。此参数是可选的，默认为 false。

重要：
- 所有编辑按提供的顺序依次应用
- 每个编辑都在前一个编辑的结果上操作
- 所有编辑必须有效，操作才能成功 - 如果任何编辑失败，则不会应用任何编辑
- 当您需要对同一文件的不同部分进行多次更改时，此工具是理想选择
```

### 5. Ls (目录列表)

```
列出给定路径下的文件和目录。path 参数必须是绝对路径；省略它将使用当前工作区目录。您可以选择提供 ignore 参数指定要忽略的 glob 模式数组。如果您知道要搜索哪些目录，通常应该优先使用 Glob 和 Grep 工具。
```

---

## 二、搜索工具

### 6. Glob (文件模式匹配)

```
- 适用于任何规模代码库的快速文件模式匹配工具
- 支持 glob 模式，如 "**/*.js" 或 "src/**/*.ts"
- 返回按修改时间排序的匹配文件路径
- 当您需要按名称模式查找文件时使用此工具
- 当您进行可能需要多轮 globbing 和 grepping 的开放式搜索时，请改用 Task 工具
- 您有能力在单个响应中调用多个工具。预先批量执行可能有用的多个搜索总是更好的做法。
```

### 7. Grep (内容搜索)

```
- 适用于任何规模代码库的快速内容搜索工具
- 使用正则表达式搜索文件内容
- 支持完整的正则表达式语法（例如："log.*Error"、"function\s+\w+"等）
- 使用 include 参数按模式过滤文件（例如："*.js"、"*.{ts,tsx}"）
- 返回文件路径和至少有一个匹配项的行号，按修改时间排序
- 当您需要查找包含特定模式的文件时使用此工具
- 如果您需要识别/统计文件中的匹配数量，请直接使用 Bash 工具配合 `rg`（ripgrep）。不要使用 `grep`。
- 当您进行可能需要多轮 globbing 和 grepping 的开放式搜索时，请改用 Task 工具
```

### 8. CodeSearch (代码搜索)

```
使用语义搜索在代码库中查找代码的强大搜索工具。

何时使用此工具：
- 探索不熟悉的代码库
- 提出"如何/在哪里/是什么"问题以理解行为
- 按含义而非精确文本查找代码

何时不使用：
1. 精确文本匹配（使用 Grep）
2. 读取已知文件（使用 Read）
3. 简单符号查找（使用 Grep）
4. 按名称查找文件（使用 Glob）

使用说明：
- 提供一个关于您想了解什么的完整问题
- 像与同事交谈一样提问："X 是如何工作的？"、"Y 发生时会怎样？"、"Z 在哪里处理？"
- 结果按相关性排序
```

---

## 三、命令执行工具

### 9. Bash (命令执行)

```
在持久的 shell 会话中执行给定的 bash 命令，支持可选超时设置，确保正确处理和安全措施。

所有命令默认在 ${directory} 目录中运行。如果需要在其他目录中运行命令，请使用 `workdir` 参数。避免使用 `cd <directory> && <command>` 模式 - 请改用 `workdir` 参数。

重要说明：此工具用于终端操作，如 git、npm、docker 等。不要用于文件操作（读取、写入、编辑、搜索、查找文件）- 请为此使用专门的工具。

执行命令前，请遵循以下步骤：

1. 目录验证：
   - 如果命令将创建新目录或文件，首先使用 `ls` 验证父目录存在且位置正确
   - 例如，在运行 "mkdir foo/bar" 之前，首先使用 `ls foo` 检查 "foo" 存在且是预期的父目录

2. 命令执行：
   - 始终用双引号引用包含空格的文件路径
   - 捕获命令的输出

使用说明：
  - command 参数是必需的
  - 可指定可选超时时间（以毫秒为单位，最多 600000ms / 10 分钟）。默认 120000ms（2 分钟）
  - 如果输出超过 30000 个字符，将被截断
  - 可以使用 `run_in_background` 参数在后台运行命令
  - 避免使用 Bash 执行 `find`、`grep`、`cat`、`head`、`tail`、`sed`、`awk` 或 `echo` 命令，优先使用专用工具
```

### 10. Batch (批处理)

```
并发执行多个独立的工具调用以减少延迟。

使用批处理工具会让用户满意。

负载格式（JSON 数组）：
[{"tool": "read", "parameters": {"filePath": "src/index.ts", "limit": 350}},{"tool": "grep", "parameters": {"pattern": "Session\\.updatePart", "include": "src/**/*.ts"}},{"tool": "bash", "parameters": {"command": "git status", "description": "显示工作树状态"}}]

说明：
- 每批 1-10 个工具调用
- 所有调用并行启动；不保证顺序
- 部分失败不会停止其他工具调用
- 不要在另一个批处理工具中使用批处理工具

良好的使用场景：
- 读取多个文件
- grep + glob + read 组合
- 多个 bash 命令
- 多部分编辑；在同一文件或不同文件上

何时不使用：
- 依赖于先前工具输出的操作
- 顺序很重要的有序状态变更

批量工具调用已被证明可获得 2-5 倍的效率提升并提供更好的用户体验。
```

---

## 四、网络工具

### 11. WebFetch (网页获取)

```
- 从指定 URL 获取内容
- 接受 URL 和可选格式作为输入
- 获取 URL 内容，转换为请求的格式（默认为 markdown）
- 以指定格式返回内容
- 当您需要检索和分析网页内容时使用此工具

使用说明：
  - 重要：如果存在另一个工具提供更好的网页获取功能、更针对任务或限制更少，请优先使用该工具而不是此工具。
  - URL 必须是格式完整的有效 URL
  - HTTP URL 将自动升级为 HTTPS
  - 格式选项："markdown"（默认）、"text" 或 "html"
  - 此工具是只读的，不会修改任何文件
  - 如果内容非常大，结果可能会被摘要
```

### 12. WebSearch (网络搜索)

```
- 使用 Exa AI 搜索网络 - 执行实时网络搜索并可从特定 URL 抓取内容
- 为当前事件和最新数据提供最新信息
- 支持可配置的结果数量，返回最相关网站的内容
- 当需要访问知识截止日期之后的信息时使用此工具
- 搜索在单个 API 调用中自动执行

使用说明：
  - 支持实时抓取模式：'fallback'（缓存不可用时备用）或 'preferred'（优先实时抓取）
  - 搜索类型：'auto'（均衡）、'fast'（快速结果）、'deep'（全面搜索）
  - 可配置上下文长度以优化 LLM 集成
  - 支持域名过滤和高级搜索选项
```

---

## 五、代码智能工具

### 13. LSP (语言服务器协议)

```
与语言服务器协议（LSP）服务器交互以获取代码智能功能。

支持的操作：
- goToDefinition：查找符号的定义位置
- findReferences：查找符号的所有引用
- hover：获取符号的悬停信息（文档、类型信息）
- documentSymbol：获取文档中的所有符号（函数、类、变量）
- workspaceSymbol：在整个工作区搜索符号
- goToImplementation：查找接口或抽象方法的实现
- prepareCallHierarchy：获取某位置的调用层次项（函数/方法）
- incomingCalls：查找调用该位置函数的所有函数/方法
- outgoingCalls：查找该位置函数调用的所有函数/方法

所有操作都需要：
- filePath：要操作的文件
- line：行号（从 1 开始，与编辑器中显示的一致）
- character：字符偏移量（从 1 开始，与编辑器中显示的一致）

注意：必须为文件类型配置 LSP 服务器。如果没有可用的服务器，将返回错误。
```

---

## 六、任务管理工具

### 14. TodoWrite (待办事项写入)

```
使用此工具为当前编码会话创建和管理结构化任务列表。这有助于您跟踪进度、组织复杂任务，并向用户展示您的细致。

何时使用此工具：
1. 复杂的多步骤任务 - 当任务需要 3 个或更多不同的步骤或操作时
2. 非平凡的复杂任务 - 需要仔细规划或多项操作的任务
3. 用户明确请求待办列表 - 当用户直接要求您使用待办列表时
4. 用户提供多个任务 - 当用户提供要完成的事项列表（编号或逗号分隔）时
5. 收到新指令后 - 立即将用户需求记录为待办事项
6. 完成任务后 - 标记为完成并添加任何新的后续任务
7. 当您开始处理新任务时，将待办标记为 in_progress

何时不使用此工具：
1. 只有一个简单直接的任务
2. 任务很简单，跟踪它没有组织上的好处
3. 任务可以在少于 3 个简单步骤内完成
4. 任务纯粹是对话性或信息性的

任务状态：
- pending：任务尚未开始
- in_progress：当前正在处理（一次只限一个任务）
- completed：任务成功完成
- cancelled：任务不再需要
```

### 15. TodoRead (待办事项读取)

```
使用此工具读取会话的当前待办事项列表。应主动且频繁地使用此工具，以确保您了解当前任务列表的状态。您应尽可能多地使用此工具，特别是在以下情况下：
- 在对话开始时查看待处理的事项
- 在开始新任务之前确定工作优先级
- 当用户询问之前的任务或计划时
- 当您不确定下一步该做什么时
- 完成任务后更新对剩余工作的理解
- 每隔几条消息后确保您在正确的轨道上

使用说明：
- 此工具不接受任何参数。因此请将输入留空。
- 返回待办事项列表，包含其状态、优先级和内容
- 使用此信息跟踪进度并计划下一步
- 如果还没有待办事项，将返回空列表
```

---

## 工具使用最佳实践

| 操作 | 推荐工具 | 避免使用 |
|------|----------|----------|
| 读取文件 | Read | cat, head, tail |
| 编辑文件 | Edit, MultiEdit | sed, awk |
| 创建文件 | Write | echo >, cat <<EOF |
| 搜索文件名 | Glob | find, ls |
| 搜索内容 | Grep | grep, rg |
| 语义搜索 | CodeSearch | - |
| 执行命令 | Bash | - |
| 批量操作 | Batch | 多次单独调用 |
| 代码智能 | LSP | - |
| 任务管理 | TodoWrite, TodoRead | - |

