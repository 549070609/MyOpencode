# 钩子提示词 (hook-prompts.txt)

## 用途说明

钩子提示词是在特定系统事件时注入的提示词模板，用于控制 AI 在特定情况下的行为。包括压缩上下文注入、待办事项继续和循环继续等。

## 主要特点

- 事件触发
- 动态占位符
- 上下文保持
- 任务继续

---

## 完整提示词内容

### 1. 压缩上下文注入提示词

```
[压缩上下文注入]

在总结此会话时，您必须在摘要中包含以下部分：

## 1. 用户请求（原样）
- 列出所有原始用户请求，完全按照陈述的方式
- 保留用户的确切措辞和意图

## 2. 最终目标
- 用户最终想要实现什么
- 预期的最终结果或交付物

## 3. 已完成的工作
- 到目前为止做了什么
- 创建/修改的文件
- 实现的功能
- 解决的问题

## 4. 剩余任务
- 还需要做什么
- 原始请求中的待处理项目
- 工作期间识别的后续任务

## 5. 禁止事项（关键约束）
- 明确禁止的事情
- 失败的方法，不应重试
- 用户明确的限制或偏好
- 会话期间识别的反模式

此上下文对于压缩后保持连续性至关重要。
```

---

### 2. 待办事项继续强制提示词

```
[系统提醒 - 待办事项继续]

未完成的任务仍在您的待办事项列表中。继续处理下一个待处理任务。

- 无需请求许可即可继续
- 完成后标记每个任务为已完成
- 在所有任务完成之前不要停止

[状态：X/Y 已完成，Z 剩余]
```

**注意**：状态行在注入提示词时用实际计数动态添加。

---

### 3. Ralph 循环继续提示词

```
[RALPH 循环 - 迭代 {{ITERATION}}/{{MAX}}]

您之前的尝试没有输出完成承诺。继续处理任务。

重要：
- 审查您到目前为止的进度
- 从您离开的地方继续
- 当完全完成时，输出：<promise>{{PROMISE}}</promise>
- 在任务真正完成之前不要停止

原始任务：
{{PROMPT}}
```

**注意**：占位符 {{ITERATION}}、{{MAX}}、{{PROMISE}} 和 {{PROMPT}} 在注入提示词时用实际值动态替换。

---

## 关键特性

### 1. 压缩上下文注入

| 部分 | 内容 |
|------|------|
| 用户请求 | 原始请求的精确措辞 |
| 最终目标 | 预期结果和交付物 |
| 已完成工作 | 进度和成果 |
| 剩余任务 | 待处理项目 |
| 禁止事项 | 约束和反模式 |

**用途**：在会话压缩时保持关键上下文，确保 AI 在压缩后能继续工作。

### 2. 待办事项继续

| 要素 | 说明 |
|------|------|
| 触发 | 存在未完成的待办事项 |
| 行为 | 自动继续下一个任务 |
| 状态 | 显示完成进度 |

**用途**：当用户消息后检测到未完成的待办事项时注入，强制 AI 继续工作。

### 3. Ralph 循环继续

| 要素 | 说明 |
|------|------|
| 迭代 | 当前/最大迭代次数 |
| 承诺 | 完成时输出的标记 |
| 原始任务 | 最初的用户请求 |

**用途**：当 AI 未能在规定步骤内完成任务时，强制继续迭代。

---

## 动态占位符

| 占位符 | 说明 |
|--------|------|
| `{{ITERATION}}` | 当前迭代次数 |
| `{{MAX}}` | 最大迭代次数 |
| `{{PROMISE}}` | 完成承诺标记 |
| `{{PROMPT}}` | 原始用户提示 |
| `X/Y` | 已完成/总任务数 |
| `Z` | 剩余任务数 |

---

## 使用场景

1. **会话压缩**：保持长对话的关键上下文
2. **任务继续**：确保多步骤任务完成
3. **循环恢复**：处理中断的工作流程
4. **进度跟踪**：显示任务完成状态

